<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PB Pricing (Fallback)</title>
  <style>
    body{font-family: -apple-system, BlinkMacSystemFont, Arial; margin:0; padding:16px; background:#111; color:#fff;}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media(max-width:820px){.row{grid-template-columns:1fr;}}
    input{width:140px;padding:8px;border-radius:8px;border:1px solid #333;background:#000;color:#fff;text-align:right}
    .card{border:1px solid #333;border-radius:10px;padding:12px;margin-bottom:12px}
    .money{border:1px dashed #444;border-radius:10px;padding:10px}
    .big{font-size:24px;font-weight:800}
    button{padding:8px 12px;border-radius:8px;border:1px solid #444;background:#222;color:#fff}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; color:#bbb}
  </style>
</head>
<body>
  <h1>PickleBean Pricing (Fallback)</h1>
  <div class="card">
    <div class="row">
      <label>Pack <input id="pack" type="number" value="2" min="1" step="1"></label>
      <label>Width (in) <input id="w" type="number" value="6" step="0.1"></label>
      <label>Height (in) <input id="h" type="number" value="2" step="0.1"></label>
      <label>Item price (£) <input id="itemPrice" type="number" placeholder="blank = suggest" step="0.01"></label>
      <label>Target margin <input id="margin" type="number" value="0.5" step="0.01"></label>
      <label>Shipping you charge (£) <input id="shipCharge" type="number" placeholder="blank = cost" step="0.01"></label>
    </div>
  </div>
  <div class="row">
    <div class="card">
      <h3>Materials</h3>
      <label>Vinyl WxL (in) <input id="vinylW" type="number" value="12" step="0.1"> × 
        <input id="vinylL" type="number" value="120" step="0.1"></label><br>
      <label>Vinyl cost (£) <input id="vinylC" type="number" value="10.99" step="0.01"></label><br>
      <label>Tape WxL (in) <input id="tapeW" type="number" value="12" step="0.1"> × 
        <input id="tapeL" type="number" value="120" step="0.1"></label><br>
      <label>Tape cost (£) <input id="tapeC" type="number" value="6.5" step="0.01"></label><br>
      <label>Waste <input id="waste" type="number" value="0.1" step="0.01"></label>
    </div>
    <div class="card">
      <h3>Packaging/Fees</h3>
      <label>Env pack (£/pack) <input id="envPackC" type="number" value="2.99" step="0.01"></label>
      <label>Envelopes/pack <input id="envPerPack" type="number" value="50" step="1"></label>
      <label>Postage (£) <input id="postage" type="number" value="0.87" step="0.01"></label>
      <label>Insert (£) <input id="insert" type="number" value="0" step="0.01"></label>
      <label>Etsy % <input id="etsyPct" type="number" value="0.065" step="0.001"></label>
      <label>Proc % <input id="procPct" type="number" value="0.04" step="0.001"></label>
      <label>Proc fixed (£) <input id="procFixed" type="number" value="0.2" step="0.01"></label>
      <label>Listing (£) <input id="listFee" type="number" value="0.2" step="0.01"></label>
      <label>Overhead (£) <input id="overhead" type="number" value="0.1" step="0.01"></label>
      <label>Labour £/hr <input id="labourRate" type="number" value="12" step="0.1"></label>
      <label>Labour mins <input id="labourMins" type="number" value="8" step="1"></label>
    </div>
  </div>
  <div class="card">
    <div class="row">
      <div class="money"><div>Item price</div><div id="outItem" class="big">£0.00</div></div>
      <div class="money"><div>Shipping</div><div id="outShip" class="big">£0.00</div></div>
      <div class="money"><div>Profit/order</div><div id="outProfit" class="big">£0.00</div></div>
      <div class="money"><div>Margin (item)</div><div id="outMargin" class="big">—</div></div>
      <div class="money"><div>Profit/sticker</div><div id="outPerSticker" class="big">£0.00</div></div>
    </div>
  </div>
  <button id="reset">Reset</button>
  <div id="status" class="mono"></div>
<script>
(function(){
  const £=(n)=>isFinite(n)?new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP'}).format(n):"£0.00";
  const ids=["pack","w","h","itemPrice","margin","shipCharge","vinylW","vinylL","vinylC","tapeW","tapeL","tapeC","waste","envPackC","envPerPack","postage","insert","etsyPct","procPct","procFixed","listFee","overhead","labourRate","labourMins"];
  const el=Object.fromEntries(ids.map(id=>[id,document.getElementById(id)]));
  function read(id){ const v=parseFloat(el[id].value); return isNaN(v)?0:v; }
  function compute(){
    const pack=Math.max(1,Math.floor(read("pack")));
    const w=Math.max(0,read("w")), h=Math.max(0,read("h"));
    const itemPriceRaw=el.itemPrice.value.trim();
    const itemPriceInput=itemPriceRaw===""?NaN:Math.max(0,read("itemPrice"));
    const margin=Math.min(0.99,Math.max(0,read("margin")));
    const vinylW=read("vinylW"),vinylL=read("vinylL"),vinylC=read("vinylC");
    const tapeW=read("tapeW"),tapeL=read("tapeL"),tapeC=read("tapeC");
    const waste=Math.min(0.95,Math.max(0,read("waste")));
    const envPackC=read("envPackC"), envPerPack=Math.max(1,Math.floor(read("envPerPack")));
    const postage=read("postage"), insert=read("insert");
    const shipRaw=el.shipCharge.value.trim();
    const shipInput=shipRaw===""?NaN:Math.max(0,read("shipCharge"));
    const etsyPct=read("etsyPct"), procPct=read("procPct"), procFixed=read("procFixed");
    const listFee=read("listFee"), overhead=read("overhead");
    const labourRate=read("labourRate"), labourMins=read("labourMins");
    const stickerArea=w*h;
    const vinylArea=vinylW*vinylL, tapeArea=tapeW*tapeL;
    const usableVinyl=vinylArea*(1-waste), usableTape=tapeArea*(1-waste);
    const spv=stickerArea>0?Math.floor(usableVinyl/stickerArea):0;
    const spt=stickerArea>0?Math.floor(usableTape/stickerArea):0;
    const cvps=spv>0?(vinylC/spv):0; const ctps=spt>0?(tapeC/spt):0;
    const materialsPerOrder=(cvps+ctps)*pack;
    const envPerOrder=envPackC/envPerPack;
    const shippingCost=envPerOrder+postage+insert;
    const labourCost=labourRate*(labourMins/60);
    const itemCost=materialsPerOrder+listFee+overhead+labourCost;
    const itemPrice=isNaN(itemPriceInput)?((1-margin)>0?(itemCost/(1-margin)):0):itemPriceInput;
    const fees=itemPrice*etsyPct + itemPrice*procPct + procFixed;
    const profitOnItem=itemPrice-(itemCost+fees);
    const shipCharge=isNaN(shipInput)?shippingCost:shipInput;
    const totalProfit=profitOnItem+(shipCharge-shippingCost);
    const itemMargin=itemPrice>0?(profitOnItem/itemPrice):NaN;
    const perSticker=pack>0?(totalProfit/pack):0;
    document.getElementById("outItem").textContent=£(itemPrice);
    document.getElementById("outShip").textContent=£(shipCharge);
    document.getElementById("outProfit").textContent=£(totalProfit);
    document.getElementById("outMargin").textContent=isNaN(itemMargin)?"—":(itemMargin*100).toFixed(1)+"%";
    document.getElementById("outPerSticker").textContent=£(perSticker);
    document.getElementById("status").textContent="JS OK • "+new Date().toLocaleTimeString();
  }
  ids.forEach(id=>el[id].addEventListener("input",compute));
  document.getElementById("reset").addEventListener("click",()=>{
    ['pack','w','h','itemPrice','margin','shipCharge'].forEach((k,i)=>el[k].value=["2","6","2","","0.5",""][i]);
    ['vinylW','vinylL','vinylC','tapeW','tapeL','tapeC','waste'].forEach((k,i)=>el[k].value=["12","120","10.99","12","120","6.5","0.1"][i]);
    ['envPackC','envPerPack','postage','insert','etsyPct','procPct','procFixed','listFee','overhead','labourRate','labourMins'].forEach((k,i)=>el[k].value=["2.99","50","0.87","0","0.065","0.04","0.2","0.2","0.1","12","8"][i]);
    compute();
  });
  document.getElementById("reset").click();
})();</script>
</body>
</html>
