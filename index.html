<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>PickleBean Press — Etsy Pricing Calculator</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="apple-touch-icon" href="./icon-180.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#8a63d2">
  <style>
    :root {
      --bg: #0f1217;
      --panel: #161b22;
      --accent: #8a63d2;
      --muted: #9aa4b2;
      --ok: #1f6feb;
      --warn: #f2cc60;
      --good: #2ea043;
      --bad: #f85149;
      --input: #fff2cc;
      --calc: #e2efda;
      --text: #e6edf3;
      --border: rgba(255,255,255,0.06);
    }
    .light {
      --bg: #f7f9fc;
      --panel: #ffffff;
      --accent: #7a52ff;
      --muted: #5c6b7a;
      --ok: #2962ff;
      --warn: #e8b024;
      --good: #2e7d32;
      --bad: #d32f2f;
      --input: #fff7d6;
      --calc: #e8f5e9;
      --text: #0f141a;
      --border: rgba(0,0,0,0.08);
    }
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; background: var(--bg); color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, system-ui, sans-serif; line-height: 1.35; }
    header { position: sticky; top: 0; z-index: 3; background: linear-gradient(180deg, rgba(22,27,34,0.95), rgba(22,27,34,0.88) 70%, rgba(22,27,34,0)); backdrop-filter: saturate(1.2) blur(6px);
      padding: 12px 16px; border-bottom: 1px solid var(--border); }
    .light header { background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.88) 70%, rgba(255,255,255,0)); }
    header h1 { margin: 0; font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    header .right { margin-left: auto; display: flex; gap: 8px; align-items: center; }
    .tabs { display: flex; gap: 8px; padding: 8px 16px; border-bottom: 1px solid var(--border); }
    .tab { padding: 8px 12px; border-radius: 999px; border: 1px solid var(--border); cursor: pointer; font-weight: 700; }
    .tab.active { background: var(--accent); color: white; border-color: transparent; }
    main { padding: 16px; display: grid; grid-template-columns: 1fr; gap: 14px; max-width: 980px; margin: 0 auto; }
    .row { display: grid; gap: 14px; }
    @media (min-width: 820px) { .row { grid-template-columns: 1fr 1fr; } }
    section.card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 14px; }
    section.card h2 { margin: 0 0 10px 0; font-size: 16px; color: inherit; display: flex; align-items: center; justify-content: space-between; }
    section.card h2 .mini { font-size: 12px; color: var(--muted); font-weight: 500; }
    .grid { display: grid; gap: 10px; grid-template-columns: 1fr 1fr; }
    .grid .full { grid-column: 1 / -1; }
    label { display: flex; align-items: center; justify-content: space-between; gap: 10px; font-size: 14px; color: inherit; }
    input[type="number"], select { width: 140px; padding: 10px 10px; border-radius: 10px; border: 1px solid var(--border); background: transparent; color: inherit; text-align: right; font-size: 16px; }
    input[type="checkbox"] { transform: scale(1.2); }
    .help { color: var(--muted); font-size: 12px; margin-top: 4px; }
    .btns { display: flex; flex-wrap: wrap; gap: 10px; }
    button, .btn { appearance: none; -webkit-appearance: none; border: 1px solid var(--border); border-radius: 10px; background: transparent; color: inherit; padding: 10px 14px; font-size: 15px; font-weight: 600; }
    button.primary { background: var(--ok); border-color: transparent; color: white; }
    button.good { background: var(--good); border-color: transparent; color: white; }
    button.warn { background: var(--warn); color: #111; border-color: transparent; }
    .money { background: transparent; border: 1px solid var(--border); padding: 12px; border-radius: 10px; }
    .money h3 { margin: 0 0 6px 0; font-size: 14px; color: var(--muted); }
    .money .big { font-size: 28px; font-weight: 800; }
    .money .sub { font-size: 13px; color: var(--muted); }
    .pill { display: inline-block; padding: 4px 8px; border-radius: 999px; font-weight: 700; font-size: 12px; }
    .pill.good { background: #162d1a; color: #57d26a; }
    .pill.bad { background: #2d1616; color: #ff8b8b; }
    .pill.neutral { background: #1c2330; color: #9db5ff; }
    .divider { height: 1px; background: var(--border); margin: 8px 0; }
    footer { color: var(--muted); font-size: 12px; padding: 20px 16px 40px; text-align: center; }
    .small { font-size: 12px; color: var(--muted); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <header>
    <h1>PickleBean Pricing</h1>
    <div class="right">
      <button id="themeToggle" class="btn">Toggle theme</button>
    </div>
  </header>

  <div class="tabs">
    <div class="tab active" data-tab="calc">Calculator</div>
    <div class="tab" data-tab="quick">Quick Quote</div>
  </div>

  <main id="calcTab">
    <section class="card">
      <h2>Order / Product <span class="mini">Yellow = inputs</span></h2>
      <div class="grid">
        <label>Pack size<input type="number" id="pack" step="1" min="1" value="2"></label>
        <div></div>
        <label>Sticker width (in)<input type="number" id="w" step="0.1" min="0" value="6"></label>
        <label>Sticker height (in)<input type="number" id="h" step="0.1" min="0" value="2"></label>
        <label>Item price you plan to charge (£)<input type="number" id="itemPrice" step="0.01" min="0" placeholder="leave blank for suggestion"></label>
        <label>Desired margin (if price blank)<input type="number" id="margin" step="0.01" min="0" max="0.99" value="0.5"></label>
        <div class="help full">Leave item price blank to get a suggested price based on your target margin.</div>
      </div>
    </section>

    <div class="row">
      <section class="card">
        <h2>Materials</h2>
        <div class="grid">
          <label>Vinyl roll width (in)<input type="number" id="vinylW" step="0.1" min="0" value="12"></label>
          <label>Vinyl roll length (in)<input type="number" id="vinylL" step="0.1" min="0" value="120"></label>
          <label>Vinyl roll cost (£)<input type="number" id="vinylC" step="0.01" min="0" value="10.99"></label>
          <label>Transfer tape width (in)<input type="number" id="tapeW" step="0.1" min="0" value="12"></label>
          <label>Transfer tape length (in)<input type="number" id="tapeL" step="0.1" min="0" value="120"></label>
          <label>Transfer tape roll cost (£)<input type="number" id="tapeC" step="0.01" min="0" value="6.50"></label>
          <label>Waste/scrap allowance (%)<input type="number" id="waste" step="0.01" min="0" max="0.9" value="0.10"></label>
        </div>
      </section>

      <section class="card">
        <h2>Packaging & Shipping</h2>
        <div class="grid">
          <label>Envelope pack cost (£)<input type="number" id="envPackC" step="0.01" min="0" value="2.99"></label>
          <label>Envelopes per pack<input type="number" id="envPerPack" step="1" min="1" value="50"></label>
          <label>Stamp/postage per order (£)<input type="number" id="postage" step="0.01" min="0" value="0.87"></label>
          <label>Insert/backing card per order (£)<input type="number" id="insert" step="0.01" min="0" value="0.00"></label>
          <label class="full">Shipping you charge (£)<input type="number" id="shipCharge" step="0.01" min="0" placeholder="auto = shipping cost"></label>
          <div class="help full">Leave shipping blank to charge your exact shipping cost.</div>
        </div>
      </section>
    </div>

    <div class="row">
      <section class="card">
        <h2>Fees & Overheads</h2>
        <div class="grid">
          <label>Etsy transaction fee (%)<input type="number" id="etsyPct" step="0.001" min="0" max="1" value="0.065"></label>
          <label>Payment processing fee (%)<input type="number" id="procPct" step="0.001" min="0" max="1" value="0.04"></label>
          <label>Payment processing fixed (£)<input type="number" id="procFixed" step="0.01" min="0" value="0.20"></label>
          <label>Listing fee per order (£)<input type="number" id="listFee" step="0.01" min="0" value="0.20"></label>
          <label>Overhead per order (£)<input type="number" id="overhead" step="0.01" min="0" value="0.10"></label>
          <label>Labour rate (£/hr)<input type="number" id="labourRate" step="0.1" min="0" value="12"></label>
          <label>Labour mins per order<input type="number" id="labourMins" step="1" min="0" value="8"></label>
        </div>
      </section>

      <section class="card">
        <h2>Results</h2>
        <div class="grid">
          <div class="money full">
            <h3>Item price to charge</h3>
            <div class="big" id="outItem">£0.00</div>
            <div class="sub">Suggested if left blank.</div>
          </div>
          <div class="money">
            <h3>Shipping to charge</h3>
            <div class="big" id="outShip">£0.00</div>
          </div>
          <div class="money">
            <h3>Estimated profit / order</h3>
            <div class="big" id="outProfit">£0.00</div>
            <div class="sub" id="outBadge"></div>
          </div>
          <div class="money">
            <h3>Profit margin (item)</h3>
            <div class="big" id="outMargin">—</div>
          </div>
          <div class="money">
            <h3>Profit per sticker</h3>
            <div class="big" id="outPerSticker">£0.00</div>
          </div>
        </div>
        <div class="divider"></div>
        <div class="small mono" id="debug"></div>
      </section>
    </div>

    <section class="card">
      <h2>Quick actions</h2>
      <div class="btns">
        <button class="primary" id="btnReset">Reset to defaults</button>
        <button id="btnSave">Save preset (local)</button>
        <button id="btnLoad">Load preset</button>
        <button class="good" id="btnShare">Share link</button>
        <button class="warn" id="btnExport">Export JSON</button>
        <input type="file" id="fileImport" accept=".json" style="display:none;">
        <button id="btnImport">Import JSON</button>
      </div>
      <div class="help">“Share link” works best if this file is hosted (e.g., GitHub Pages, Netlify). Otherwise use Export/Import JSON.</div>
    </section>

    <section class="card">
      <h2>Preset</h2>
      <div class="btns">
        <button id="btnPresetIG">Instagram Tag Stickers — 2 pack</button>
      </div>
      <div class="help">Applies your usual 6×2in sticker, 2-pack, current costs & fees.</div>
    </section>
  </main>

  <!-- Quick Quote Tab -->
  <main id="quickTab" class="hidden">
    <section class="card">
      <h2>Quick Quote</h2>
      <div class="grid">
        <label>Pack size<input type="number" id="qq_pack" step="1" min="1" value="2"></label>
        <label>Sticker size (W × H, in) <input type="number" id="qq_w" step="0.1" min="0" value="6"></label>
        <label></label><input type="number" id="qq_h" step="0.1" min="0" value="2">
        <label>Item price (£) — optional<input type="number" id="qq_itemPrice" step="0.01" min="0" placeholder="leave blank"></label>
        <label>Target margin (if price blank)<input type="number" id="qq_margin" step="0.01" min="0" max="0.99" value="0.5"></label>
        <label>Shipping you’ll charge (£, optional)<input type="number" id="qq_ship" step="0.01" min="0" placeholder="auto = cost"></label>
        <div class="help full">Uses your existing defaults for materials, fees, labour, and postage. Change them on the Calculator tab.</div>
      </div>
    </section>
    <section class="card">
      <h2>Result</h2>
      <div class="grid">
        <div class="money full">
          <h3>Item price</h3>
          <div class="big" id="qq_outItem">£0.00</div>
        </div>
        <div class="money">
          <h3>Shipping to charge</h3>
          <div class="big" id="qq_outShip">£0.00</div>
        </div>
        <div class="money">
          <h3>Profit / order</h3>
          <div class="big" id="qq_outProfit">£0.00</div>
        </div>
        <div class="money">
          <h3>Profit per sticker</h3>
          <div class="big" id="qq_outPerSticker">£0.00</div>
        </div>
      </div>
    </section>
  </main>

  <footer>Made for Jamie & Sam — PickleBean Press ✨</footer>

<script>
(function(){
  // Theme toggle with persistence
  const THEME_KEY = "pb_theme";
  const preferLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
  let theme = localStorage.getItem(THEME_KEY) || (preferLight ? "light" : "dark");
  if (theme === "light") document.documentElement.classList.add("light");
  document.getElementById("themeToggle").addEventListener("click", () => {
    document.documentElement.classList.toggle("light");
    theme = document.documentElement.classList.contains("light") ? "light" : "dark";
    localStorage.setItem(THEME_KEY, theme);
  });

  // Tabs
  const tabs = document.querySelectorAll(".tab");
  const calcTab = document.getElementById("calcTab");
  const quickTab = document.getElementById("quickTab");
  tabs.forEach(t => t.addEventListener("click", () => {
    tabs.forEach(x => x.classList.remove("active"));
    t.classList.add("active");
    const name = t.dataset.tab;
    if (name === "calc") { calcTab.classList.remove("hidden"); quickTab.classList.add("hidden"); }
    else { quickTab.classList.remove("hidden"); calcTab.classList.add("hidden"); }
  }));

  // Reuse calculator logic
  const £ = (n) => isFinite(n) ? new Intl.NumberFormat('en-GB',{style:'currency',currency:'GBP'}).format(n) : "£0.00";
  const ids = ["pack","w","h","itemPrice","margin","vinylW","vinylL","vinylC","tapeW","tapeL","tapeC","waste","envPackC","envPerPack","postage","insert","shipCharge","etsyPct","procPct","procFixed","listFee","overhead","labourRate","labourMins"];
  const el = Object.fromEntries(ids.map(id => [id, document.getElementById(id)]));

  function read(id){ const v=parseFloat(el[id].value); return isNaN(v)?0:v; }
  function compute(){
    const pack=Math.max(1,Math.floor(read("pack")));
    const w=Math.max(0,read("w")), h=Math.max(0,read("h"));
    const itemPriceRaw=el.itemPrice.value.trim();
    const itemPriceInput=itemPriceRaw===""?NaN:Math.max(0,read("itemPrice"));
    const margin=Math.min(0.99,Math.max(0,read("margin")));
    const vinylW=Math.max(0,read("vinylW")), vinylL=Math.max(0,read("vinylL")), vinylC=Math.max(0,read("vinylC"));
    const tapeW=Math.max(0,read("tapeW")), tapeL=Math.max(0,read("tapeL")), tapeC=Math.max(0,read("tapeC"));
    const waste=Math.min(0.95,Math.max(0,read("waste")));
    const envPackC=Math.max(0,read("envPackC")), envPerPack=Math.max(1,Math.floor(read("envPerPack")));
    const postage=Math.max(0,read("postage")), insert=Math.max(0,read("insert"));
    const shipRaw=el.shipCharge.value.trim();
    const shipInput=shipRaw===""?NaN:Math.max(0,read("shipCharge"));
    const etsyPct=Math.max(0,read("etsyPct"));
    const procPct=Math.max(0,read("procPct"));
    const procFixed=Math.max(0,read("procFixed"));
    const listFee=Math.max(0,read("listFee"));
    const overhead=Math.max(0,read("overhead"));
    const labourRate=Math.max(0,read("labourRate"));
    const labourMins=Math.max(0,read("labourMins"));

    const stickerArea=w*h;
    const vinylArea=vinylW*vinylL;
    const tapeArea=tapeW*tapeL;
    const usableVinyl=vinylArea*(1-waste);
    const usableTape=tapeArea*(1-waste);
    const stickersPerVinyl=stickerArea>0?Math.floor(usableVinyl/stickerArea):0;
    const stickersPerTape=stickerArea>0?Math.floor(usableTape/stickerArea):0;
    const costVinylPerSticker=stickersPerVinyl>0?(vinylC/stickersPerVinyl):0;
    const costTapePerSticker=stickersPerTape>0?(tapeC/stickersPerTape):0;
    const materialsPerSticker=costVinylPerSticker+costTapePerSticker;
    const materialsPerOrder=materialsPerSticker*pack;
    const envPerOrder=envPackC/envPerPack;
    const shippingCost=envPerOrder+postage+insert;
    const labourCost=labourRate*(labourMins/60);
    const itemCost=materialsPerOrder+listFee+overhead+labourCost;
    const itemPrice=isNaN(itemPriceInput)?((1-margin)>0?(itemCost/(1-margin)):0):itemPriceInput;
    const etsyFee=itemPrice*etsyPct;
    const procFeePct=itemPrice*procPct;
    const feesTotal=etsyFee+procFeePct+procFixed;
    const profitOnItem=itemPrice-(itemCost+feesTotal);
    const shipCharge=isNaN(shipInput)?shippingCost:shipInput;
    const totalProfit=profitOnItem+(shipCharge-shippingCost);
    const itemMargin=itemPrice>0?(profitOnItem/itemPrice):NaN;
    const profitPerSticker=pack>0?(totalProfit/pack):0;

    document.getElementById("outItem").textContent=£(itemPrice);
    document.getElementById("outShip").textContent=£(shipCharge);
    document.getElementById("outProfit").textContent=£(totalProfit);
    document.getElementById("outMargin").textContent=isNaN(itemMargin)?"—":(itemMargin*100).toFixed(1)+"%";
    document.getElementById("outPerSticker").textContent=£(profitPerSticker);

    const badge=document.getElementById("outBadge");
    badge.innerHTML = totalProfit>0?'<span class="pill good">Profit</span>':(totalProfit<0?'<span class="pill bad">Loss</span>':'<span class="pill neutral">Break-even</span>');

    // For quick quote defaults
    return {pack,w,h,itemPrice,margin,shippingCost,shipCharge,totalProfit,profitPerSticker};
  }

  // Events
  ids.forEach(id=>el[id].addEventListener("input", compute));

  // Defaults and presets
  const defaultState=()=>({pack:2,w:6,h:2,itemPrice:"",margin:0.5,vinylW:12,vinylL:120,vinylC:10.99,tapeW:12,tapeL:120,tapeC:6.50,waste:0.10,envPackC:2.99,envPerPack:50,postage:0.87,insert:0.00,shipCharge:"",etsyPct:0.065,procPct:0.04,procFixed:0.20,listFee:0.20,overhead:0.10,labourRate:12,labourMins:8});
  function setState(s){ Object.keys(s).forEach(k=>{ const e=document.getElementById(k); if(e) e.value=s[k]; }); compute(); }
  function getState(){ const s={}; ids.forEach(id=>s[id]=document.getElementById(id).value); return s; }

  document.getElementById("btnReset").addEventListener("click",()=>setState(defaultState()));
  document.getElementById("btnPresetIG").addEventListener("click",()=>{ const s=defaultState(); s.pack=2;s.w=6;s.h=2;s.itemPrice="";s.margin=0.5; setState(s); });

  // Save/load/share
  const KEY="picklebean_pricing_preset";
  document.getElementById("btnSave").addEventListener("click",()=>{ localStorage.setItem(KEY, JSON.stringify(getState())); alert("Preset saved on this device."); });
  document.getElementById("btnLoad").addEventListener("click",()=>{ const raw=localStorage.getItem(KEY); if(!raw) return alert("No preset saved yet."); try{ setState(JSON.parse(raw)); }catch(e){ alert("Couldn't load preset."); }});
  function stateToQuery(s){ const p=new URLSearchParams(); for(const[k,v] of Object.entries(s)) if(String(v).length) p.set(k,v); return p.toString(); }
  function queryToState(){ const q=new URLSearchParams(location.search); const s=defaultState(); let changed=false; for(const k of Object.keys(s)){ if(q.has(k)){ s[k]=q.get(k); changed=true;} } return changed?s:null; }
  document.getElementById("btnShare").addEventListener("click", async()=>{ const url=location.href.split("?")[0]+"?"+stateToQuery(getState()); try{ await navigator.clipboard.writeText(url); alert("Link copied to clipboard."); } catch(e){ prompt("Copy link:", url); } });
  document.getElementById("btnExport").addEventListener("click",()=>{ const blob=new Blob([JSON.stringify(getState(),null,2)],{type:"application/json"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="picklebean_pricing_preset.json"; a.click(); URL.revokeObjectURL(a.href); });
  document.getElementById("btnImport").addEventListener("click",()=>document.getElementById("fileImport").click());
  document.getElementById("fileImport").addEventListener("change",(e)=>{ const f=e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=>{ try{ setState(JSON.parse(r.result)); }catch(e){ alert("Couldn't parse JSON."); } }; r.readAsText(f); });

  // Quick Quote hookup (uses the same compute + defaults)
  const qids = ["qq_pack","qq_w","qq_h","qq_itemPrice","qq_margin","qq_ship"];
  const qel = Object.fromEntries(qids.map(id=>[id, document.getElementById(id)]));
  function qq_read(id){ const v=parseFloat(qel[id].value); return isNaN(v)?0:v; }
  function quickQuote(){
    // Temporarily apply QQ values to calculator, compute, then restore
    const backup = getState();
    const s = defaultState();
    s.pack = Math.max(1, Math.floor(qq_read("qq_pack")));
    s.w = Math.max(0, parseFloat(qel.qq_w.value)||0);
    s.h = Math.max(0, parseFloat(qel.qq_h.value)||0);
    const priceStr = qel.qq_itemPrice.value.trim();
    s.itemPrice = priceStr === "" ? "" : Math.max(0, parseFloat(priceStr)||0);
    s.margin = Math.min(0.99, Math.max(0, parseFloat(qel.qq_margin.value)||0.5));
    const shipStr = qel.qq_ship.value.trim();
    s.shipCharge = shipStr === "" ? "" : Math.max(0, parseFloat(shipStr)||0);
    setState(s);
    const res = compute();
    // Outputs (reuse DOM updated in compute)
    document.getElementById("qq_outItem").textContent = document.getElementById("outItem").textContent;
    document.getElementById("qq_outShip").textContent = document.getElementById("outShip").textContent;
    document.getElementById("qq_outProfit").textContent = document.getElementById("outProfit").textContent;
    document.getElementById("qq_outPerSticker").textContent = document.getElementById("outPerSticker").textContent;
    // Restore original calc state
    setState(backup);
  }
  qids.forEach(id=>qel[id].addEventListener("input", quickQuote));

  // Initialise
  const qs=queryToState();
  setState(qs||defaultState());
  quickQuote();
})();
</script>
</body>
</html>
