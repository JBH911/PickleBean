<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PickleBean Press — Pricing Calculator</title>
<style>
:root{
  --bg:#0f0f12; --panel:#15161a; --panel-2:#1c1e24;
  --text:#e9e9ef; --muted:#a1a7b1;
  --brand:#7a5cff; --accent:#b084ff;
  --ok:#30d158; --warn:#ff9f0a; --err:#ff453a;
  --r:14px; --shadow:0 8px 28px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial}
header{position:sticky;top:0;background:linear-gradient(180deg,#111218,#0f0f1200);border-bottom:1px solid #1f2230;backdrop-filter:blur(6px);padding:14px 18px;z-index:2}
.brand{display:flex;align-items:center;gap:12px}
.logo{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--accent));display:grid;place-items:center;color:#fff;font-weight:800;box-shadow:var(--shadow)}
h1{margin:0;font-size:18px}
.sub{margin:2px 0 0;color:var(--muted);font-size:13px}
nav.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
nav.tabs button{padding:10px 14px;border-radius:10px;background:var(--panel);border:1px solid #242632;color:var(--text);cursor:pointer}
nav.tabs button.active{outline:2px solid var(--brand)}
main{max-width:1100px;margin:24px auto;padding:0 18px;min-height:60vh}
.panel{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid #222636;border-radius:var(--r);padding:18px;box-shadow:var(--shadow);margin-bottom:16px}
.grid{display:grid;gap:14px}
.grid.cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
.grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
@media(max-width:900px){.grid.cols-3{grid-template-columns:1fr 1fr}}
@media(max-width:680px){.grid.cols-2,.grid.cols-3{grid-template-columns:1fr}}
.field{display:flex;flex-direction:column;gap:8px}
label{font-size:13px;color:var(--muted)}
input,select,textarea{background:#0c0d11;border:1px solid #272b39;color:var(--text);border-radius:12px;padding:12px}
button{border:0;border-radius:12px;padding:12px 16px;cursor:pointer;background:var(--panel);color:var(--text);box-shadow:var(--shadow)}
button.primary{background:linear-gradient(135deg,var(--brand),var(--accent));color:#fff}
button.ghost{background:#0c0d11;border:1px solid #272b39}
.kpi{display:flex;gap:12px;flex-wrap:wrap;margin-top:8px}
.kpi .chip{background:#0c0d11;border:1px solid #272b39;border-radius:999px;padding:8px 12px;font-size:13px;color:var(--muted)}
.price-lg{font-size:40px;font-weight:800;margin:0}
footer{border-top:1px solid #1f2230;padding:18px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between}
.hidden{display:none}
hr{border:0;border-top:1px solid #272b39;margin:16px 0}
small.muted{color:var(--muted)}
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo" aria-hidden="true">PB</div>
    <div>
      <h1>Pricing Calculator</h1>
      <p class="sub">Single-file — multi-category</p>
    </div>
  </div>
  <nav class="tabs" role="tablist" aria-label="Calculator sections">
    <button data-tab="home" class="active" role="tab">Home</button>
    <button data-tab="stickers" role="tab">Stickers</button>
    <button data-tab="apparel" role="tab">Apparel</button>
    <button data-tab="engraving" role="tab">Engraving</button>
    <button data-tab="homeware" role="tab">Homeware</button>
    <button data-tab="books" role="tab">Books</button>
    <button data-tab="settings" role="tab" style="margin-left:auto">Settings</button>
    <button data-tab="qq" role="tab">Quick Quote</button>
  </nav>
</header>

<main>
  <section id="tab-home" class="panel">
    <h2>Welcome</h2>
    <p>This single-file calculator has full tabs for all categories. Use <b>Settings</b> to adjust fees/postage/margin and <b>Quick Quote</b> for fast estimates.</p>
  </section>

  <section id="tab-stickers" class="panel hidden"></section>
  <section id="tab-apparel" class="panel hidden"></section>
  <section id="tab-engraving" class="panel hidden"></section>
  <section id="tab-homeware" class="panel hidden"></section>
  <section id="tab-books" class="panel hidden"></section>

  <section id="tab-settings" class="panel hidden">
    <h2>Settings</h2>
    <div class="grid cols-3" id="settings-form"></div>
    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="primary" id="save-settings">Save</button>
      <button id="clear-settings">Revert to defaults</button>
    </div>
    <p class="small muted">Settings save locally (per device) via localStorage.</p>
  </section>

  <section id="tab-qq" class="panel hidden">
    <h2>Quick Quote</h2>
    <div class="grid cols-3" id="qq-form"></div>
    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="primary" id="qq-calc">Calculate</button>
      <button id="qq-clear">Clear</button>
    </div>
    <div class="panel" style="margin-top:16px">
      <h3>Estimate</h3>
      <p id="qq-total" class="price-lg">—</p>
      <div id="qq-breakdown" class="kpi"></div>
    </div>
  </section>
</main>

<footer>
  <div class="footer-actions">
    <button id="btn-copy" class="ghost">Copy Quote</button>
    <button id="btn-reset" class="ghost">Reset</button>
    <button id="btn-export" class="primary">Export JSON</button>
  </div>
  <small>© <span id="year"></span> PickleBean Press</small>
</footer>

<script>
/* ---------- Core utils & config ---------- */
const $=(s,r=document)=>r.querySelector(s);
const money=(n,c='GBP')=>new Intl.NumberFormat('en-GB',{style:'currency',currency:c}).format(n);
const store=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const load=(k)=>{try{return JSON.parse(localStorage.getItem(k))}catch{return null}};
const defaults={platform_pct:6.5,payment_fixed:0.20,postage_flat:0.87,margin_pct:50,currency:'GBP'};
let cfg=Object.assign({},defaults,load('pb_settings')||{});

const Calc={
  lines:[],
  reset(){this.lines=[]},
  add(label,qty,unit){this.lines.push({label,qty,unit,cost:qty*unit})},
  subtotal(){return this.lines.reduce((a,b)=>a+b.cost,0)}
};
function totals(){
  const s=Calc.subtotal();
  const fees=s*(cfg.platform_pct/100)+cfg.payment_fixed;
  const post=cfg.postage_flat;
  const margin=s*(cfg.margin_pct/100);
  return {subtotal:s,fees,postage:post,margin,grand:s+fees+post+margin};
}

/* ---------- Tabs & actions ---------- */
document.querySelectorAll('nav.tabs button').forEach(b=>b.onclick=()=>{document.querySelectorAll('nav.tabs button').forEach(x=>x.classList.remove('active'));b.classList.add('active');Object.values(panels).forEach(p=>p.classList.add('hidden'));panels[b.dataset.tab].classList.remove('hidden');location.hash=b.dataset.tab});
const panels={home:$('#tab-home'),stickers:$('#tab-stickers'),apparel:$('#tab-apparel'),engraving:$('#tab-engraving'),homeware:$('#tab-homeware'),books:$('#tab-books'),settings:$('#tab-settings'),qq:$('#tab-qq')};
$('#year').textContent=new Date().getFullYear();

$('#btn-copy').onclick=()=>navigator.clipboard.writeText(JSON.stringify({cfg,last:window.lastQuote||{}},null,2)).then(()=>alert('Copied!'));
$('#btn-reset').onclick=()=>{localStorage.clear();location.reload()};
$('#btn-export').onclick=()=>{const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([JSON.stringify({cfg,last:window.lastQuote||{}},null,2)],{type:'application/json'}));a.download='calculator-state.json';a.click()};

/* ---------- Settings ---------- */
const sf=$('#settings-form');
[['Platform Fee %','platform_pct',cfg.platform_pct],
 ['Payment Fee (fixed)','payment_fixed',cfg.payment_fixed],
 ['Default Postage (flat)','postage_flat',cfg.postage_flat],
 ['Default Margin %','margin_pct',cfg.margin_pct],
 ['Currency','currency',cfg.currency]
].forEach(([label,key,val])=>{
  const d=document.createElement('div');d.className='field';
  if(key==='currency'){ d.innerHTML=`<label>${label}</label><select data-key="${key}"><option>GBP</option><option>USD</option><option>EUR</option></select>`; d.querySelector('select').value=val; }
  else { d.innerHTML=`<label>${label}</label><input type="number" step="0.01" value="${val}" data-key="${key}">`; }
  sf.append(d);
});
$('#save-settings').onclick=()=>{
  const out={};
  sf.querySelectorAll('input,select').forEach(el=>{
    const k=el.dataset.key;
    out[k]=el.tagName==='SELECT'?el.value:Number(el.value);
  });
  store('pb_settings',out); alert('Saved'); location.reload();
};
$('#clear-settings').onclick=()=>{localStorage.removeItem('pb_settings'); location.reload()};

/* ---------- Quick Quote ---------- */
const qf=$('#qq-form');
(function buildQQ(){
  const rows=[
    ['Category','select',['Stickers','Apparel','Engraving','Homeware','Books','Other']],
    ['Description','text','e.g., 2× Instagram tag decals, white'],
    ['Quantity','number',2,0.01],
    ['Unit Material Cost (£)','number',0.35,0.01],
    ['Unit Labour Cost (£)','number',0.20,0.01],
    ['Target Margin %','number',cfg.margin_pct,1],
    ['Postage (flat)','number',cfg.postage_flat,0.01],
    ['Platform Fee %','number',cfg.platform_pct,0.1],
    ['Payment Fee (fixed)','number',cfg.payment_fixed,0.01],
    ['Currency','select',['GBP','USD','EUR']],
    ['Customer Name (optional)','text','e.g., Sam'],
    ['Notes (optional)','text','Gift message, colour, deadline…'],
  ];
  rows.forEach(([label,type,val,step])=>{
    const d=document.createElement('div'); d.className='field'; d.innerHTML=`<label>${label}</label>`;
    if(type==='select'){
      const s=document.createElement('select'); (Array.isArray(val)?val:[val]).forEach(v=>{const o=document.createElement('option');o.value=v;o.textContent=v;s.append(o)}); if(label==='Currency') s.value=cfg.currency; d.append(s);
    }else if(type==='number'){
      const i=document.createElement('input'); i.type='number'; i.step=String(step||1); i.value=val; d.append(i);
    }else{ const i=document.createElement('input'); i.placeholder=val||''; d.append(i); }
    qf.append(d);
  });
})();
$('#qq-calc').onclick=()=>{
  const els=qf.querySelectorAll('input,select');
  const data={
    category:els[0].value, description:els[1].value, qty:+els[2].value||0,
    unitMat:+els[3].value||0, unitLab:+els[4].value||0,
    marginPct:+els[5].value||0, postage:+els[6].value||0,
    feePct:+els[7].value||0, feeFixed:+els[8].value||0,
    currency:els[9].value
  };
  Calc.reset(); Calc.add('Materials',data.qty,data.unitMat); Calc.add('Labour',data.qty,data.unitLab);
  const s=Calc.subtotal(); const f=s*(data.feePct/100)+data.feeFixed; const p=data.postage; const m=s*(data.marginPct/100); const g=s+f+p+m;
  window.lastQuote={category:data.category, description:data.description, lines:Calc.lines, totals:{subtotal:s,fees:f,postage:p,margin:m,grand:g}, currency:data.currency};
  $('#qq-total').textContent=money(g,data.currency);
  $('#qq-breakdown').innerHTML=`<div class="chip">Subtotal: ${money(s,data.currency)}</div><div class="chip">Platform Fees: ${money(f,data.currency)}</div><div class="chip">Postage: ${money(p,data.currency)}</div><div class="chip">Margin: ${money(m,data.currency)}</div>`;
};
$('#qq-clear').onclick=()=>{$('#qq-total').textContent='—';$('#qq-breakdown').innerHTML='';qf.querySelectorAll('input').forEach(i=>i.value='')};

/* ---------- Helpers to build category UIs ---------- */
function chip(label,val,c=cfg.currency){ const d=document.createElement('div'); d.className='chip'; d.textContent=`${label}: ${money(val,c)}`; return d; }
function resultPanel(root,idPrefix){
  const panel=document.createElement('div'); panel.className='panel'; panel.style.marginTop='16px';
  panel.innerHTML=`<h3>Totals</h3><p id="${idPrefix}-total" class="price-lg">—</p><div id="${idPrefix}-bk" class="kpi"></div><hr><div id="${idPrefix}-lines" class="kpi"></div>`;
  root.append(panel);
  return {
    set(t,lines,curr=cfg.currency){
      $('#'+idPrefix+'-total').textContent=money(t.grand,curr);
      const bk=$('#'+idPrefix+'-bk'); bk.innerHTML=''; bk.append(chip('Subtotal',t.subtotal,curr),chip('Platform Fees',t.fees,curr),chip('Postage',t.postage,curr),chip('Margin',t.margin,curr));
      const ln=$('#'+idPrefix+'-lines'); ln.innerHTML=''; lines.forEach(L=>ln.append(chip(`${L.label} (${L.qty} × ${money(L.unit,curr)})`, L.cost, curr)));
    },
    clear(){ $('#'+idPrefix+'-total').textContent='—'; $('#'+idPrefix+'-bk').innerHTML=''; $('#'+idPrefix+'-lines').innerHTML=''; }
  };
}

/* ---------- Stickers ---------- */
(function(){
  const root=$('#tab-stickers');
  root.innerHTML=`
    <h2>Stickers</h2>
    <div class="grid cols-3" id="stk-form">
      <div class="field"><label>Quantity</label><input id="stk-qty" type="number" min="1" value="2"></div>
      <div class="field"><label>Sticker Width (in)</label><input id="stk-w" type="number" step="0.01" value="6"></div>
      <div class="field"><label>Sticker Height (in)</label><input id="stk-h" type="number" step="0.01" value="2"></div>
      <div class="field"><label>Wastage / Offcuts %</label><input id="stk-waste" type="number" step="1" value="10"></div>
      <div class="field"><label>Labour per sticker (min)</label><input id="stk-min" type="number" step="0.1" value="1.5"></div>
      <div class="field"><label>Labour rate (£/hr)</label><input id="stk-rate" type="number" step="0.01" value="12"></div>
      <div class="field"><label>Vinyl roll width (in)</label><input id="vinyl-w" type="number" step="0.1" value="12"></div>
      <div class="field"><label>Vinyl roll length (ft)</label><input id="vinyl-l" type="number" step="0.1" value="10"></div>
      <div class="field"><label>Vinyl roll cost (£)</label><input id="vinyl-cost" type="number" step="0.01" value="10.99"></div>
      <div class="field"><label>Transfer tape roll cost (£)</label><input id="tape-cost" type="number" step="0.01" value="6.50"></div>
      <div class="field"><label>Apply tape (≈ sticker area)?</label><select id="tape-area"><option value="1" selected>Yes</option><option value="0">No (0)</option></select></div>
      <div class="field"><label>Extra tape margin %</label><input id="tape-margin" type="number" step="1" value="0"></div>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="primary" id="stk-calc">Calculate</button>
      <button id="stk-clear">Clear</button>
    </div>`;
  const out=resultPanel(root,'stk');

  const id=x=>document.getElementById(x);
  function calc(){
    const qty=+id('stk-qty').value||0, w=+id('stk-w').value||0, h=+id('stk-h').value||0;
    const waste=(+id('stk-waste').value||0)/100, minPer=+id('stk-min').value||0, rate=+id('stk-rate').value||0;
    const rollW=+id('vinyl-w').value||0, rollLft=+id('vinyl-l').value||0, vCost=+id('vinyl-cost').value||0;
    const tCost=+id('tape-cost').value||0, tFactor=+id('tape-area').value||0, tMargin=(+id('tape-margin').value||0)/100;

    const stickerArea=w*h; // in^2
    const stickerAreaWaste=stickerArea*(1+waste);
    const rollArea=rollW*(rollLft*12); // in^2
    const vinylPerIn2=rollArea? vCost/rollArea : 0;
    const tapePerIn2 =rollArea? tCost /rollArea : 0;
    const tapeAreaPer=stickerArea*tFactor*(1+tMargin);

    const matPer = stickerAreaWaste*vinylPerIn2 + tapeAreaPer*tapePerIn2;
    const labourPer=(minPer/60)*rate;

    Calc.reset(); Calc.add('Materials',qty,matPer); Calc.add('Labour',qty,labourPer);
    const t=totals(); out.set(t,Calc.lines,cfg.currency);
  }
  $('#stk-calc').onclick=calc;
  $('#stk-clear').onclick=()=>{root.querySelectorAll('input').forEach(i=>i.value=''); out.clear()};
})();

/* ---------- Apparel (DTF/HTV press style) ---------- */
(function(){
  const root=$('#tab-apparel');
  root.innerHTML=`
    <h2>Apparel</h2>
    <div class="grid cols-3" id="app-form">
      <div class="field"><label>Quantity</label><input id="app-qty" type="number" min="1" value="10"></div>
      <div class="field"><label>Blank garment cost (£)</label><input id="app-blank" type="number" step="0.01" value="3.50"></div>
      <div class="field"><label>Print method</label>
        <select id="app-method"><option>DTF</option><option>HTV</option></select>
      </div>
      <div class="field"><label>Transfer/print cost per item (£)</label><input id="app-transfer" type="number" step="0.01" value="1.20"></div>
      <div class="field"><label>Press time per item (min)</label><input id="app-time" type="number" step="0.1" value="0.7"></div>
      <div class="field"><label>Labour rate (£/hr)</label><input id="app-rate" type="number" step="0.01" value="12"></div>
      <div class="field"><label>Setup time (min)</label><input id="app-setup" type="number" step="0.1" value="5"></div>
      <div class="field"><label>Packaging per item (£)</label><input id="app-pack" type="number" step="0.01" value="0.15"></div>
      <div class="field"><label>Wastage % (misprints)</label><input id="app-waste" type="number" step="1" value="3"></div>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="primary" id="app-calc">Calculate</button>
      <button id="app-clear">Clear</button>
    </div>`;
  const out=resultPanel(root,'app');
  const id=x=>document.getElementById(x);

  function calc(){
    const qty=+id('app-qty').value||0, blank=+id('app-blank').value||0, transfer=+id('app-transfer').value||0;
    const time=+id('app-time').value||0, rate=+id('app-rate').value||0, setup=+id('app-setup').value||0;
    const pack=+id('app-pack').value||0, waste=(+id('app-waste').value||0)/100;

    const effectiveQty = qty*(1+waste);
    const matPer = blank + transfer + pack;
    const labourTotalHrs = (setup/60) + (time/60)*qty;
    const labourPer = (labourTotalHrs*rate)/qty;

    Calc.reset(); Calc.add('Materials',qty,matPer); Calc.add('Labour',qty,labourPer); Calc.add('Wastage allowance', qty*(waste), matPer); // simple waste model
    const t=totals(); out.set(t,Calc.lines,cfg.currency);
  }
  $('#app-calc').onclick=calc;
  $('#app-clear').onclick=()=>{root.querySelectorAll('input').forEach(i=>i.value=''); out.clear()};
})();

/* ---------- Engraving (laser/CNC) ---------- */
(function(){
  const root=$('#tab-engraving');
  root.innerHTML=`
    <h2>Engraving</h2>
    <div class="grid cols-3" id="eng-form">
      <div class="field"><label>Quantity</label><input id="eng-qty" type="number" min="1" value="5"></div>
      <div class="field"><label>Material cost per unit (£)</label><input id="eng-mat" type="number" step="0.01" value="1.00"></div>
      <div class="field"><label>Engrave time per unit (min)</label><input id="eng-time" type="number" step="0.1" value="3.0"></div>
      <div class="field"><label>Machine rate (£/hr)</label><input id="eng-rate" type="number" step="0.01" value="18"></div>
      <div class="field"><label>Setup time (min)</label><input id="eng-setup" type="number" step="0.1" value="4"></div>
      <div class="field"><label>Finishing time per unit (min)</label><input id="eng-finish" type="number" step="0.1" value="0.5"></div>
      <div class="field"><label>Operator labour (£/hr)</label><input id="eng-oprate" type="number" step="0.01" value="12"></div>
      <div class="field"><label>Packaging per unit (£)</label><input id="eng-pack" type="number" step="0.01" value="0.10"></div>
      <div class="field"><label>Wastage %</label><input id="eng-waste" type="number" step="1" value="2"></div>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="primary" id="eng-calc">Calculate</button>
      <button id="eng-clear">Clear</button>
    </div>`;
  const out=resultPanel(root,'eng');
  const id=x=>document.getElementById(x);

  function calc(){
    const qty=+id('eng-qty').value||0, mat=+id('eng-mat').value||0, pack=+id('eng-pack').value||0, waste=(+id('eng-waste').value||0)/100;
    const tPer=+id('eng-time').value||0, rate=+id('eng-rate').value||0, setup=+id('eng-setup').value||0, finish=+id('eng-finish').value||0, opr=+id('eng-oprate').value||0;

    const machineHours = (setup/60) + (tPer/60)*qty;
    const machineCostTotal = machineHours * rate;
    const operatorHours = (finish/60)*qty;
    const operatorCostTotal = operatorHours * opr;

    const matPer = mat + pack;
    const labourPer = (machineCostTotal + operatorCostTotal)/qty;

    Calc.reset(); Calc.add('Materials',qty,matPer); Calc.add('Labour',qty,labourPer); Calc.add('Wastage allowance', qty*waste, matPer);
    const t=totals(); out.set(t,Calc.lines,cfg.currency);
  }
  $('#eng-calc').onclick=calc;
  $('#eng-clear').onclick=()=>{root.querySelectorAll('input').forEach(i=>i.value=''); out.clear()};
})();

/* ---------- Homeware (e.g., mugs, coasters) ---------- */
(function(){
  const root=$('#tab-homeware');
  root.innerHTML=`
    <h2>Homeware</h2>
    <div class="grid cols-3" id="hw-form">
      <div class="field"><label>Quantity</label><input id="hw-qty" type="number" min="1" value="6"></div>
      <div class="field"><label>Blank cost per unit (£)</label><input id="hw-blank" type="number" step="0.01" value="2.10"></div>
      <div class="field"><label>Print/consumable per unit (£)</label><input id="hw-cons" type="number" step="0.01" value="0.80"></div>
      <div class="field"><label>Labour per unit (min)</label><input id="hw-min" type="number" step="0.1" value="1.2"></div>
      <div class="field"><label>Labour rate (£/hr)</label><input id="hw-rate" type="number" step="0.01" value="12"></div>
      <div class="field"><label>Packaging per unit (£)</label><input id="hw-pack" type="number" step="0.01" value="0.20"></div>
      <div class="field"><label>Setup time (min)</label><input id="hw-setup" type="number" step="0.1" value="3"></div>
      <div class="field"><label>Wastage %</label><input id="hw-waste" type="number" step="1" value="2"></div>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="primary" id="hw-calc">Calculate</button>
      <button id="hw-clear">Clear</button>
    </div>`;
  const out=resultPanel(root,'hw');
  const id=x=>document.getElementById(x);

  function calc(){
    const qty=+id('hw-qty').value||0, blank=+id('hw-blank').value||0, cons=+id('hw-cons').value||0, pack=+id('hw-pack').value||0;
    const min=+id('hw-min').value||0, rate=+id('hw-rate').value||0, setup=+id('hw-setup').value||0, waste=(+id('hw-waste').value||0)/100;

    const matPer = blank + cons + pack;
    const labourTotal = ((setup/60) + (min/60)*qty)*rate;
    const labourPer = labourTotal/qty;

    Calc.reset(); Calc.add('Materials',qty,matPer); Calc.add('Labour',qty,labourPer); Calc.add('Wastage allowance', qty*waste, matPer);
    const t=totals(); out.set(t,Calc.lines,cfg.currency);
  }
  $('#hw-calc').onclick=calc;
  $('#hw-clear').onclick=()=>{root.querySelectorAll('input').forEach(i=>i.value=''); out.clear()};
})();

/* ---------- Books (simple booklet costing) ---------- */
(function(){
  const root=$('#tab-books');
  root.innerHTML=`
    <h2>Books</h2>
    <div class="grid cols-3" id="bk-form">
      <div class="field"><label>Quantity</label><input id="bk-qty" type="number" min="1" value="20"></div>
      <div class="field"><label>Pages per book</label><input id="bk-pages" type="number" min="1" value="40"></div>
      <div class="field"><label>Print cost per page (£)</label><input id="bk-pp" type="number" step="0.001" value="0.05"></div>
      <div class="field"><label>Cover cost per book (£)</label><input id="bk-cover" type="number" step="0.01" value="0.60"></div>
      <div class="field"><label>Binding cost per book (£)</label><input id="bk-bind" type="number" step="0.01" value="0.40"></div>
      <div class="field"><label>Setup time (min)</label><input id="bk-setup" type="number" step="0.1" value="10"></div>
      <div class="field"><label>Labour per book (min)</label><input id="bk-min" type="number" step="0.1" value="1.5"></div>
      <div class="field"><label>Labour rate (£/hr)</label><input id="bk-rate" type="number" step="0.01" value="12"></div>
      <div class="field"><label>Wastage %</label><input id="bk-waste" type="number" step="1" value="2"></div>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
      <button class="primary" id="bk-calc">Calculate</button>
      <button id="bk-clear">Clear</button>
    </div>`;
  const out=resultPanel(root,'bk');
  const id=x=>document.getElementById(x);

  function calc(){
    const qty=+id('bk-qty').value||0, pages=+id('bk-pages').value||0, pp=+id('bk-pp').value||0;
    const cover=+id('bk-cover').value||0, bind=+id('bk-bind').value||0;
    const setup=+id('bk-setup').value||0, min=+id('bk-min').value||0, rate=+id('bk-rate').value||0, waste=(+id('bk-waste').value||0)/100;

    const matPer = pages*pp + cover + bind;
    const labourTotal = (setup/60)*rate + (min/60)*rate*qty;
    const labourPer = labourTotal/qty;

    Calc.reset(); Calc.add('Materials',qty,matPer); Calc.add('Labour',qty,labourPer); Calc.add('Wastage allowance', qty*waste, matPer);
    const t=totals(); out.set(t,Calc.lines,cfg.currency);
  }
  $('#bk-calc').onclick=calc;
  $('#bk-clear').onclick=()=>{root.querySelectorAll('input').forEach(i=>i.value=''); out.clear()};
})();

/* ---------- Load tab from URL hash (optional) ---------- */
if (location.hash && panels[location.hash.slice(1)]) {
  document.querySelector(`nav.tabs button[data-tab="${location.hash.slice(1)}"]`)?.click();
}
</script>
</body>
</html>
